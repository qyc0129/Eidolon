# Eidolon（ Android App 2016-2017 ）
#### Producted By: YuchenQiu XingyuYan HaoZeng YeLiu PengyiQian JiaqiLuo
## 1. 介绍
- 产品的初期想法主要分为两部分，第一部分用来分析音乐片段音调组成，属于输入模块，第二部分属于输出模块，将音乐以多种不同的形式表现出来。
  -  第一部分用来分析音乐片段音调组成，属于输入模块，采用模式识别技术，app将自行对其进行噪音消除处理，方便音调分析功能的进行。然后APP将音乐文件进行单位分割，并通过频谱分析功能确定每个最小单位片段的音调，以画谱形式表现。
  -  第二部分属于输出模块，先输出标准格式的五线谱，将音乐以多种不同的形式表现出来，例如用钢琴音，同时模拟钢琴按键会与五线谱同步按下琴键。同时APP会将音频输出到MIDI文件中，以便保存，方便上传至云端进行储存。
## 2. 架构设计
- 手机前端部分：鉴于本项目制作的是基于Android的手机App,前端部分由Java实现，使用Android Studio等开发平台进行开发。本项目的大部分功能由手机端的JAVA编码程序实现，此部分是本项目的重点与难点，是开发的关键所在。Android的界面非常丰富，可选择性很强，开发环境十分宽泛自由。Android Studio作为新兴起的开发软件，基于IntelliJ IDEA.，类似 Eclipse ADT，比起Eclipse更容易上手。
- 服务器后端部分：先使用Mysql建立用户数据库，储存用户的注册信息，如手机号、密码等信息。为了实现云存储与数据分享等功能，需要用服务器接收储存数据，为此使用Python搭建服务程序开放特定端口接收手机客户端发送的信息。Python可以轻松地使用HTTP协议与手机前端进行握手数据交流，然后对数据库进行操作储存用户的信息。
- 验证：手机端先发送一个带有用户ID特征码的的信息到服务器上验证身份，然后进行用户数据信息的上传或从云端的下载。

## 3.QA
- 主界面共有五个按钮

  -  clear用来重置当前界面已经显示的乐谱内容

  -  user用来进行用户管理，可以对用户的乐谱进行上传和下载

  -  Start 在按下后开始录音识别，哼唱过程中每次停顿产生一个音符，并在按钮松开后停止录音。

  -  play可以搜索并列出手机中的乐谱文件，并在文件选择后产生新的界面界面中进行音乐播放和乐谱显示

  -  save 可以输出乐谱文件，并选择输出乐谱的乐器形式

Q1:哼唱识别系统是怎样实现的

A1:我们本次项目的哼唱识别部分是利用了一套基频识别算法对即时产生的音乐片段进行处理，该音乐片段的采样频率为44.1Khz（人耳能感知的一般在20Khz以下）。该基频识别算法是将一段PCM音乐数据流保存在一个数组当中，求出振幅零值后，找出所有零点（分上升和下降两类），从最大频率开始一次次遍历所有零点，每次遍历完后可以得到该频率在音乐片段中所具有的强度，该遍历一直持续到频率减少到最小频率即将整个音乐片段视为1次变化的频率值。 遍历结束后找到音乐片段中占有强度最大的频率，认为该频率即整个音乐片段的基频。
每段基频识别算法的结果将会输出汇总到一个数组当中，知道遇到哼唱过程当中的一次停顿，将会结算数组当中的所有基频结果，并对其取众数作为该时间段内代表音高


Q2：降噪处理是怎么做的

A2：在人声哼唱时，不可能发生瞬间的剧烈改变。因此当剧烈改变发生时我们选择将该音乐片段舍弃。这样可以很大程度上的避免噪音干扰。但是如果周围环境过于嘈杂，我们的设备就无法正常使用了。


Q3：音符绘制系统是怎么实现的

A3：音符绘制系统就是将上一部分所产生的音高内容通过canvas绘制，直接在主界面上显示出来，音符形状是提前绘制好的，通过在主界面上位置高低的变化来代表该音符的音高。


Q4：输出文件是什么

A4：输出文件是使用了MIDI文件格式，因为MIDI格式是使用MIDI消息来控制音乐的进行，具有体型小，可控性高，易读易处理等特点，同时，其利用数字来表示音符的特点与本项目的哼唱识别系统有天然的契合性。因此MIDI格式成为了我们项目的不二之选。
我们通过学习MIDI格式，设计了一套MIDI文件输出的方法，通过将已经生成的乐谱信息和乐器信息输入该类后，能够输出完整可播放的MIDI文件。

Q6：云服务器保存形式

Q7：在云服务器端我们使用数组的形式来保存乐谱数据，其中奇数位我们存放音高信息，偶数位存放音长信息。

Q7：为什么文件搜索这么长时间

A7：因为搜索功能使用的是全盘搜索，会将整个手机存储空间内所存放的MIDI格式文件全部读取出来，所以相应的搜索时间会比较长。

Q8：项目目的和背景

A9：现如今音乐创作的形式越来越多样化，对于音乐片段的处理方式也越来越多，让具有丰富音乐创作经验的人能够得心应手的进行音乐创作和编辑。
但是数量众多的音乐处理软件和复杂的操作界面让刚刚接触音乐创作的人们望而却步。因此本项目致力于开发一款能够降低音乐创作门槛的软件，让人们在生活中能够随时随地记录自己的灵感并加以修改，此外用户还可以通过这个软件平台分享自己的创作灵感和天赋，同时了解其他人对于音乐的理解。

Q10：创新点

A10：
1、即时哼唱识别，同步乐谱生成。
2、云端共享功能，灵感永久保存。
3、无需专业知识，降低创作门槛。
## 4. 展示
  ![img](https://github.com/qyc0129/Eidolon/blob/master/1.png)
  ![img](https://github.com/qyc0129/Eidolon/blob/master/2.png)
  ![img](https://github.com/qyc0129/Eidolon/blob/master/3.png)
